document.getElementById("cems__root").innerHTML+='<div class="cems__chatbox">\n<div class="cems__chatbox__support ">\n  <div id="cems__chatbox__chatlists">\n    <div id="cems__chatlist__header">\n      <h3 id=\'cems__chatlist__header__text\'>Chats</h3>\n    </div>\n    <div id="cems__all__chatlist">\n      <div class="cems__chat__list">\n        <div class="cems__friend__icon">\n          <p>F</p>\n        </div>\n        <div class="cems__chatlist__content">\n          <h4 class="cems__chatlist__friendName">Friend\'s Name</h4>\n        </div>\n      </div>\n    </div>\n    <div class="cems__chatbox__chatlist__footer">\n      <div class="cems__chatlist__footer__button" onclick=backToChatList()>\n        <img src="https://img.icons8.com/ios/50/000000/speech-bubble-with-dots.png" />\n        <p>Chats</p>\n      </div>\n      <div class="cems__chatlist__footer__button" onclick=gotoUsers()>\n        <img src="https://img.icons8.com/ios/50/000000/user.png" />\n        <p>Users</p>\n      </div>\n\n    </div>\n  </div>\n  <div id="cems__chatbox__chatting" class="cems__hide__section">\n    <div class="cems__chatbox__header">\n      <div id="cems__chatbox_backButton--header" onclick=backToChatList()>\n        <img src="https://img.icons8.com/ios-filled/100/000000/left.png" />\n      </div>\n\n      <div class="cems__friend__icon">\n        <p>F</p>\n      </div>\n      <div class="cems__chatbox__content--header">\n        <h4 class="cems__chatbox__heading--header">Friend\'s Name</h4>\n\n      </div>\n    </div>\n    <div id="cems__chatbox__messages">\n      <div>\n        <div class="cems__messages__item cems__messages__item--visitor">\n          Can you let me talk to the support?\n        </div>\n        <div class="cems__messages__item cems__messages__item--operator">Sure!</div>\n\n      </div>\n    </div>\n    <div class="cems__chatbox__footer">\n      <img\n        src="https://img.icons8.com/external-kmg-design-outline-color-kmg-design/64/000000/external-attachment-user-interface-kmg-design-outline-color-kmg-design.png" />\n      <input type="text" placeholder="Write a message..." />\n      <button class="cems__chatbox__send--footer">Send</button>\n    </div>\n  </div>\n</div>\n<div class="cems__chatbox__button cems__hide__section" id="cems__chatbox__button">\n  <button>button</button>\n</div>\n\n<div id="cems__root"></div>\n<div id="cems__log" hidden></div>\n\x3c!-- <button id="cems__myBtn">Open Modal</button> --\x3e\n<div id="cems__myModal" class="cems__modal">\n  <div id="cems__callsection">\n\n    <div id="cems__call__content">\n      <h3 class="cems__calltype">Outgoing Call</h3>\n      <div class="cems__callImage">\n        <img class="cems__callImage" src="https://img.icons8.com/ios/50/000000/user-male-circle.png" />\n        <h4>Calling Shozon </h4>\n        <div class="cems__callButtons">\n          <button class="cems__reciveBtn">Recive</button>\n          <button class="cems__cancleBtn">Cancle</button>\n\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n</div>';let styles=".cems__chatbox{position:absolute;bottom:30px;right:30px}.cems__chatbox__support{display:flex;flex-direction:column;background:#eee;width:300px;height:350px;z-index:-123456;opacity:0;transition:all .5s ease-in-out}.cems__chatbox--active{transform:translateY(-40px);z-index:123456;opacity:1}.cems__chatbox__button{text-align:right;position:fixed;right:26px;bottom:25px}.cems__chatbox__button img{transition:transform .3s;width:40px}.cems__chatbox__header{position:sticky;top:0;background:orange}#cems__chatbox__messages{margin-top:auto;display:flex;flex-direction:column;overflow-y:scroll;min-height:70%}.cems__messages__item{background:orange;max-width:60.6%;width:fit-content}.cems__messages__item--operator{margin-left:auto}.cems__messages__item--visitor{margin-right:auto}.cems__chatbox__footer{position:sticky;bottom:0}.cems__chat__callicon img{width:25px;margin:0 10px;cursor:pointer}*{box-sizing:border-box;margin:0;padding:0}*,html{--primaryGradient:linear-gradient(93.12deg, #ffffff 0.52%, #f0e9e9 100%);--secondaryGradient:linear-gradient(268.91deg, #fefeff -2.14%, #ffffff 99.69%);--primaryBoxShadow:0px 10px 15px rgba(105, 102, 102, 0.1);--secondaryBoxShadow:0px -10px 15px rgba(0, 0, 0, 0.1);--light:300;--regular:400;--semiBold:600;--extraLight:300;--italic:300;--primary:#0998f5}body{font-family:Inter,sans-serif;font-weight:400;font-size:100%;background:#f1f1f1}::-webkit-scrollbar{width:10px}::-webkit-scrollbar-track{background:rgba(255,255,255,0)}::-webkit-scrollbar-thumb{background:#ccc}::-webkit-scrollbar-thumb:hover{background:#b1aeae}.cems__chatbox__support{background:#f9f9f9;height:430px;width:390px;box-shadow:0 0 15px rgba(0,0,0,.1);border-radius:20px;position:fixed;right:32px;bottom:79px}.cems__chatbox__header{background:#fff;display:flex;flex-direction:row;align-items:center;padding:18px 10px;border-top-left-radius:20px;border-top-right-radius:20px;justify-content:space-between;border-bottom:1px solid #e8e8e8}.cems__chat__details{display:flex;flex-direction:row;justify-content:center;align-items:center}.cems__chatbox__image--header{margin-right:10px}.cems__chatbox__heading--header{font-size:1.2rem}.cems__chatbox__image--header img{width:33px;margin-bottom:-6px}.cems__chatbox__description--header{font-size:.9rem;color:#fff}#cems__chatbox__messages{padding:0 20px}.cems__messages__item{margin-top:10px;background:#e0e0e0;padding:8px 12px;max-width:100%;font-size:13px}.cems__messages__item--operator_image{margin-left:auto;padding:0;background:0 0}.cems__messages__item--operator_image img{border-top-left-radius:20px;border-top-right-radius:20px;border-bottom-left-radius:20px}.cems__messages__item--typing,.cems__messages__item--visitor{border-top-left-radius:20px;border-top-right-radius:20px;border-bottom-right-radius:20px}.cems__messages__item--visitor_image{padding:0;background:0 0}.cems__messages__item--visitor_image img{border-top-left-radius:20px;border-top-right-radius:20px;border-bottom-right-radius:20px}.cems__messages__item--operator{border-top-left-radius:20px;border-top-right-radius:20px;border-bottom-left-radius:20px;background:var(--primary);color:#fff}.cems__chatbox__chatlist__footer,.cems__chatbox__footer{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding:10px 10px;background:var(--secondaryGradient);border-bottom-right-radius:10px;border-bottom-left-radius:10px}.cems__chatbox__chatlist__footer{justify-content:space-around;margin-top:0}.cems__chatlist__footer__button{align-items:center;text-align:center;cursor:pointer}.cems__chatlist__footer__button p{padding:4px;cursor:pointer;display:flex;flex-direction:column;-webkit-box-pack:center;justify-content:center;-webkit-box-align:center;align-items:center;font-size:12px}.cems__chatlist__footer__button img{width:25px;margin-bottom:-6px}.cems__chatbox__footer img{width:23px;cursor:pointer}.cems__chatbox__footer input{border:none;padding:10px 10px;border-radius:30px;width:90%;margin:0 10px;border:1px solid #dfdbdb}input#cems__input__message:focus-visible{outline:0}div#cems_send_message{width:100%}div#selectFileShow{padding:10px 10px;border-radius:30px;width:90%;margin:0 10px;border:1px solid #dfdbdb;font-size:12px}.cems__chatbox__send--footer{color:#fff;background:#0998f5;border:none;width:61px;height:36px;cursor:pointer;position:absolute;right:19px;border-radius:0 27px 25px 0}.cems__chatbox__button button,.cems__chatbox__button button:focus,.cems__chatbox__button button:visited{padding:14px 13px 8px 13px;background:#03a9f4;border:none;outline:0;border-radius:74px;box-shadow:0 10px 15px rgb(0 0 0 / 10%);cursor:pointer}.cems__container h4{font-size:15px;font-weight:600;line-height:22px}#cems__chatbox_backButton--header img{width:31px;justify-content:center;align-items:center;margin-bottom:-7px;margin-right:11px;cursor:pointer}div#cems__chatbox__chatting{display:flex;flex-direction:column;background:#f9f9f9;height:430px;width:390px;border-radius:38px}.cems__hide__section{display:none!important}div#cems__chatlist__header{border-bottom:1px solid #eaeaea}.cems__chatlist__content{display:block;width:100%;border-bottom:1px solid #eaeaea;padding-bottom:8px}.cems__chatlist__content p{margin:0;font-size:13px;font-weight:400;width:calc(100% - 50px);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;line-height:20px;color:rgba(20,20,20,.6)}div#cems__chatlist__header h3{padding:22px 22px;margin:0;display:inline-block;width:100%;text-align:left;font-size:22px;font-weight:700;line-height:26px}div#cems__all__chatlist{height:306px;overflow-y:scroll}p.cems__no_found{margin-top:20px;margin-left:17px}.cems__chat__list{display:flex;flex-direction:row;align-items:center;padding:12px 10px;cursor:pointer;margin:0 21px}.unseen__message h4{color:red!important}.cems__friend__icon{background:#a7baff;text-align:center;border-radius:50%;color:#000;width:48px;height:39px;justify-content:center;align-items:center;display:flex;margin:-4px 15px 2px -6px}.cems__chatHead__friend__icon{background:#a7baff;text-align:center;border-radius:50%;width:39px;height:39px;justify-content:center;align-items:center;display:flex;margin:0 9px 2px 0;color:#fcf2f2;font-weight:700;font-size:20px}.cems__friend__icon p{font-weight:700;font-size:20px;color:#fcf2f2;margin-bottom:0}.cems__modal{display:none;position:fixed;z-index:555555;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.705);justify-content:center;align-items:center;text-align:center}.cems__modal-content{background-color:#fefefe;margin:auto;padding:20px;border:1px solid #888;width:80%}.cems__close{color:#aaa;float:right;font-size:28px;font-weight:700}.cems__close:focus,.cems__close:hover{color:#000;text-decoration:none;cursor:pointer}div#cems__callsection{width:96%;height:98%;display:flex;align-items:center;justify-content:center;border-radius:20px}div#cems__call__content{position:relative;width:300px;height:385px;align-items:center;justify-content:center;display:flex;flex-direction:column;background:#fff;border-radius:10px}div#cems__call__content h3{position:absolute;top:20px}.cems__callButtons{position:absolute;bottom:0;width:100%;left:0;z-index:5555555555555}.cems__callButtons img{width:50px!important;cursor:pointer;margin:10px}.cems__callButtons button{padding:10px;margin:10px}.cems__callImage{width:100%}.cems__callImage img{width:86px}.cems__callButtons svg{width:50px!important;cursor:pointer;margin:10px;padding:0;height:auto}#cems__recivedcall__content{position:relative;width:90%;height:90%;align-items:center;justify-content:center;display:flex;flex-direction:column;background:#414141;border-radius:10px}div#cems__call__sender{position:absolute;width:19%;height:23%;top:2%;right:2%;z-index:555555555;border-radius:10px;border:1px solid #fff}div#cems__call__reciver div,div#cems__call__sender div{border-radius:20px}div#cems__call__reciver{width:100%;height:100%;border-radius:20px!important;z-index:55555555;border:1px solid #fff}div#cams__call__timer{position:absolute;z-index:5555555555;color:#34af67;font-size:18px;font-weight:700;bottom:89px}",styleSheet=document.createElement("style");styleSheet.type="text/css",styleSheet.innerText=styles,document.head.appendChild(styleSheet);let calleeId="s",calleeName="",clickFriendId="",selectFile=void 0,unreadMessageId=[],inMessages=!1,options={channel:"143142",uid:143},cmsloc=window.location.pathname,cmsdir=cmsloc.substring(1,cmsloc.lastIndexOf("/")),allDetails={userName:"",userId:"",access_token:""},newChatList=[],chatListData=[{name:"Zarif",id:234,messages:[{messageType:3,text:"How are you",timeStamp:null,username:"Zarif"},{messageType:2,text:"I am fine.",timeStamp:null,username:"shozonraj"}]},{name:"Raj",id:235,messages:[]}],friendList=[{uid:"difs-234",name:"Zarif"},{name:"Raj",uid:"difs-235"},{name:"shozon raj",uid:"difs-238"},{name:"Raj1",uid:"difs-236"},{name:"Raj3",uid:"difs-237"},{name:"shozonraj",uid:"difs-233"}];window.addEventListener("beforeunload",(function(e){localStorage.setItem(`CemsChatDataFor${allDetails.userId}`,JSON.stringify(chatListData))}));let fetchData=(uid,allMessage=[])=>{let testd=[];allMessage.map(am=>{let strStart=am.text[0],strEnd=am.text[am.text.length-1];if("["===strStart&&"]"===strEnd){let parseAm;JSON.parse(am.text).map(d=>{let isa=!0;testd.map(td=>{d.id===td.id&&(td.messages=[...td.messages,...d.messages],isa=!1)}),!0===isa&&testd.unshift(d)})}else console.log(strStart,am.text[am.text.length-2])});let data=JSON.parse(localStorage.getItem(`CemsChatDataFor${uid}`));null===data||(chatListData=void 0===data?[]:data),addchangeUser(uid)},addchangeUser=uid=>{if("242"===uid){let withoutData=chatListData.filter(data=>data.id!==uid),alData=chatListData.find(data=>"243"==data.id);chatListData=withoutData,void 0===alData&&chatListData.push({name:"user4",id:"243",messages:[]})}else{let withoutData=chatListData.filter(data=>data.id!=uid),alData=chatListData.find(data=>"242"==data.id);chatListData=withoutData,void 0===alData&&chatListData.push({name:"User3",id:"242",messages:[]})}};class agoraFuntionality{constructor(getModalSection){this.sections={getModalSection:getModalSection,getCallingType:null},this.localTracks={localAudioTrack:null,localVideoTrack:null},this.mute=!1,this.rtcClient=null,this.uid="",this.userName="",this.appId="",this.rtmToken="",this.channelId="",this.rtcToken="",this.rtmClient="",this.status="ofline",this.remoteInvitation=null,this.localInvitation=null}hidecall(res){this.sections.getCallingType.innerHTML=res,document.getElementsByClassName("cems__callButtons")[0].style.display="none",setTimeout(()=>{this.status="online",this.sections.getModalSection.style.display="none"},3e3)}async login(uid,name,appId,access_token){this.uid=uid,this.appId=appId,this.userName=name,this.rtmToken=await this.createAgoraRtmToken(uid),this.rtmClient=AgoraRTM.createInstance(appId),await this.rtmClient.login({uid:uid,token:this.rtmToken}).then(async()=>{this.peerMessageRecive(),this.RemoteInvitationReceived(),this.status="online",allDetails.userName=name,allDetails.userId=uid,allDetails.access_token=access_token,document.getElementById("cems__log").appendChild(document.createElement("div")).append("login as "+name+"id "+uid),document.getElementById("cems__chatbox__button").classList.remove("cems__hide__section"),fetchData(uid),gotoChatList(),friendList=await getFriendListData(access_token,uid)}).catch(err=>{console.log(err)})}init(uid,name,appId,access_token){this.login(uid.toString(),name,appId,access_token)}async createAgoraRtmToken(userName){try{const response=await axios.get(`https://agoratokenbs23.herokuapp.com/rtm-token?username=${userName}`);return await response.data.token}catch(error){console.error(error)}}async createAgoraRtcToken(){try{const response=await axios.get(`https://agoratokenbs23.herokuapp.com/rtc-uid-token?channelName=${this.channelId}&uid=${this.uid}`);return await response.data.token}catch(error){console.error(error)}}async sendPeerMessage(message,peerId){scrollBottom(),"call"!=message.type&&await this.rtmClient.sendMessageToPeer({text:message.text},peerId.toString()).then(sendResult=>{sendResult.hasPeerReceived?document.getElementById("cems__log").appendChild(document.createElement("div")).append("Message has been received by: "+peerId+" Message: "+message.text):document.getElementById("cems__log").appendChild(document.createElement("div")).append("Message sent to: "+peerId+" Message: "+message.text)})}peerMessageRecive(){this.rtmClient.on("MessageFromPeer",(function(message,peerId,proper){let withOutUnreadMessageId=unreadMessageId.filter(id=>id!=peerId);unreadMessageId=[...withOutUnreadMessageId,peerId],reciveMessageStoreAndOutput(message,peerId)}))}audioVideoCall=async type=>{null!=this.localInvitation&&(this.localInvitation.removeAllListeners(),this.localInvitation=null),this.localInvitation=this.rtmClient.createLocalInvitation(calleeId.toString()),this.localInvitationEvents(),this.channelId=this.uid+calleeId,this.localInvitation._channelId=this.uid+calleeId,this.localInvitation._content={name:this.userName,type:type},this.calltype=type,this.localInvitation.send(),this.sections.getModalSection.innerHTML=outgoinCallOutput(type),this.sections.getCallingType=document.getElementById("callingType"),this.status="busy",this.sections.getModalSection.style.display="flex",sendMessage(calleeId,{text:`You gave ${calleeName} a ${type} call `,type:"call"}),this.rtcToken=await this.createAgoraRtcToken(),this.joinReciveCallReciver(type)};localInvitationEvents=()=>{this.localInvitation.on("LocalInvitationReceivedByPeer",r=>{this.sections.getCallingType.innerHTML=`Calling ${calleeName}`}),this.localInvitation.on("LocalInvitationAccepted",r=>{this.joinReciveCallSender(this.localInvitation._content.type),recivedCallOutput(this.localInvitation._content.type)}),this.localInvitation.on("LocalInvitationCanceled",r=>{console.log("LocalInvitationCanceled"+r)}),this.localInvitation.on("LocalInvitationRefused",r=>{this.hidecall(`${calleeName} busy now`)}),this.localInvitation.on("LocalInvitationFailure",r=>{this.hidecall(r)})};cancelOutgoingCall(){this.localInvitation.cancel(),this.status="online",this.sections.getModalSection.style.display="none"}async RemoteInvitationReceived(){this.rtmClient.on("RemoteInvitationReceived",async remoteInvitation=>{"online"==this.status?(null!=this.remoteInvitation&&(this.remoteInvitation.removeAllListeners(),this.remoteInvitation=null),this.remoteInvitation=remoteInvitation,this.channelId=remoteInvitation._channelId,this.rtcToken=await this.createAgoraRtcToken(),incomingCallOutput(remoteInvitation._content.name,remoteInvitation._content.type),this.calltype=remoteInvitation._content.type,this.sections.getCallingType=document.getElementById("callingType"),this.status="busy",this.sections.getModalSection.style.display="flex",this.peerEvents(),reciveMessageStoreAndOutput({text:`${remoteInvitation._content.name} called You`,type:"call"},remoteInvitation.callerId),this.joinReciveCallReciver(remoteInvitation._content.type)):remoteInvitation.refuse()})}peerEvents=()=>{this.remoteInvitation.on("RemoteInvitationReceived",r=>{console.log("RemoteInvitationReceived"+r)}),this.remoteInvitation.on("RemoteInvitationAccepted",r=>{this.joinReciveCallSender(this.remoteInvitation._content.type),recivedCallOutput(this.remoteInvitation._content.type)}),this.remoteInvitation.on("RemoteInvitationCanceled",r=>{this.hidecall(`${this.remoteInvitation._content.name} canceled the call`)}),this.remoteInvitation.on("RemoteInvitationRefused",r=>{console.log("RemoteInvitationRefused "+r)}),this.remoteInvitation.on("RemoteInvitationFailure",r=>{this.hidecall(r)})};cancelIncomingCall(){this.remoteInvitation.refuse(),this.status="online",this.sections.getModalSection.style.display="none"}reciveIncomingCall(){this.remoteInvitation.accept()}async joinReciveCallReciver(type){this.rtcClient=AgoraRTC.createClient({mode:"rtc",codec:"vp8"}),this.rtcClient.on("user-published",async(user,mediaType)=>{if(await this.rtcClient.subscribe(user,mediaType),"video"==type&&"video"===mediaType){const remoteVideoTrack=user.videoTrack,fricon=document.getElementById("cems__call__reciver");remoteVideoTrack.play(fricon)}if("audio"===mediaType){const remoteAudioTrack=user.audioTrack;remoteAudioTrack.play()}this.rtcClient.on("user-unpublished",async(user,mediaType)=>{console.log("unpublish",user,mediaType)}),this.rtcClient.on("user-info-updated",async(user,msg)=>{console.log("updated",user,msg)}),this.rtcClient.on("user-left",async(user,res)=>{this.localTracks.localAudioTrack.close(),this.localTracks.localVideoTrack&&this.localTracks.localVideoTrack.close(),this.localTracks.screenVideoTrack&&this.localTracks.screenVideoTrack.close(),await this.rtcClient.leave(),this.sections.getModalSection.style.display="none",this.status="online",clearInterval(callInterval),mute=!1})})}async joinReciveCallSender(type){if(await this.rtcClient.join(this.appId,this.channelId,this.rtcToken,this.uid),this.localTracks.localAudioTrack=await AgoraRTC.createMicrophoneAudioTrack(),"video"==type){this.localTracks.localVideoTrack=await AgoraRTC.createCameraVideoTrack(),await this.rtcClient.publish([this.localTracks.localAudioTrack,this.localTracks.localVideoTrack]);const mycon=document.getElementById("cems__call__sender");this.localTracks.localVideoTrack.play(mycon)}else await this.rtcClient.publish([this.localTracks.localAudioTrack]);console.log("publish success!")}muteAudio(){this.localTracks.localAudioTrack.close()}async unmuteAudio(){this.localTracks.localAudioTrack=await AgoraRTC.createMicrophoneAudioTrack(),await this.rtcClient.publish([this.localTracks.localAudioTrack])}async screenshareOn(){this.localTracks.screenVideoTrack=await AgoraRTC.createScreenVideoTrack(),await this.rtcClient.unpublish([this.localTracks.localVideoTrack]),this.localTracks.localVideoTrack.close(),await this.rtcClient.publish([this.localTracks.screenVideoTrack]);const mycon=document.getElementById("cems__call__sender");let getscreenShareBtn;this.localTracks.screenVideoTrack.play(mycon),document.getElementById("cems_shareScreenBtn").innerHTML='<svg class="cems__cancleBtn"   onclick=screenshare() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="50" height="50" viewBox="0 0 172 172" style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#e74c3c"></path><g fill="#ffffff"><path d="M39.6288,39.6288c-5.36739,0 -9.76236,4.39497 -9.76236,9.76236v43.93061c0,5.36739 4.39497,9.76236 9.76236,9.76236h24.40589v19.52472c0,5.36739 4.39497,9.76236 9.76236,9.76236h58.57415c5.36739,0 9.76236,-4.39497 9.76236,-9.76236v-43.93061c0,-5.36739 -4.39497,-9.76236 -9.76236,-9.76236h-24.40589v-19.52472c0,-5.36739 -4.39497,-9.76236 -9.76236,-9.76236zM39.6288,44.50998h58.57415c2.7266,0 4.88118,2.15458 4.88118,4.88118v19.52472h-29.28707c-5.36739,0 -9.76236,4.39497 -9.76236,9.76236v19.52472h-24.40589c-2.72659,0 -4.88118,-2.15458 -4.88118,-4.88118v-43.93061c0,-2.72659 2.15458,-4.88118 4.88118,-4.88118zM73.79705,73.79705h58.57415c2.7266,0 4.88118,2.15458 4.88118,4.88118v43.93061c0,2.7266 -2.15458,4.88118 -4.88118,4.88118h-58.57415c-2.72659,0 -4.88118,-2.15458 -4.88118,-4.88118v-21.50769c0.06674,-0.32414 0.06674,-0.66735 0,-0.99149v-21.43143c0,-2.72659 2.15458,-4.88118 4.88118,-4.88118z"></path></g></g></svg>',this.localTracks.screenVideoTrack.on("track-ended",async()=>{screenshare()})}async screenshareOff(){this.rtcClient.unpublish([this.localTracks.screenVideoTrack]),this.localTracks.screenVideoTrack.close(),this.localTracks.localVideoTrack=await AgoraRTC.createCameraVideoTrack(),await this.rtcClient.publish([this.localTracks.localVideoTrack]);const mycon=document.getElementById("cems__call__sender");this.localTracks.localVideoTrack.play(mycon)}async leaveReciveCall(){this.localTracks.localVideoTrack&&this.localTracks.localVideoTrack.close(),this.localTracks.screenVideoTrack&&this.localTracks.screenVideoTrack.close(),this.localTracks.localAudioTrack.close(),await this.rtcClient.leave(),this.sections.getModalSection.style.display="none",this.status="online",clearInterval(callInterval),mute=!1}}let getModalSection=document.getElementById("cems__myModal"),agoraFunction=new agoraFuntionality(getModalSection),cancelOutgoingCall=()=>{agoraFunction.cancelOutgoingCall()},reciveIncomingCall=()=>{agoraFunction.reciveIncomingCall()},cancelIncoingCall=()=>{agoraFunction.cancelIncomingCall()},cancelRecivedCall=()=>{agoraFunction.leaveReciveCall()},screenShare=!1,screenshare=()=>{let getscreenShareBtn=document.getElementById("cems_shareScreenBtn");!1!==screenShare?(agoraFunction.screenshareOff(),getscreenShareBtn.innerHTML='<svg class="cems__cancleBtn"   onclick=screenshare() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 172 172" style=" fill:#000000;"><g transform=""><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#2ecc71"></path><g fill="#ffffff"><path d="M36.464,36.464c-5.73371,0 -10.42863,4.69492 -10.42863,10.42863v46.92884c0,5.73371 4.69492,10.42863 10.42863,10.42863h26.07158v20.85726c0,5.73371 4.69492,10.42863 10.42863,10.42863h62.57179c5.73371,0 10.42863,-4.69492 10.42863,-10.42863v-46.92884c0,-5.73371 -4.69492,-10.42863 -10.42863,-10.42863h-26.07158v-20.85726c0,-5.73371 -4.69492,-10.42863 -10.42863,-10.42863zM36.464,41.67832h62.57179c2.91269,0 5.21432,2.30163 5.21432,5.21432v20.85726h-31.28589c-5.73371,0 -10.42863,4.69492 -10.42863,10.42863v20.85726h-26.07158c-2.91268,0 -5.21432,-2.30163 -5.21432,-5.21432v-46.92884c0,-2.91268 2.30163,-5.21432 5.21432,-5.21432zM72.96421,72.96421h62.57179c2.91269,0 5.21432,2.30163 5.21432,5.21432v46.92884c0,2.91269 -2.30163,5.21432 -5.21432,5.21432h-62.57179c-2.91268,0 -5.21432,-2.30163 -5.21432,-5.21432v-22.97558c0.07129,-0.34626 0.07129,-0.71289 0,-1.05916v-22.89411c0,-2.91268 2.30163,-5.21432 5.21432,-5.21432z"></path></g><path d="" fill="none"></path></g></g></svg>'):agoraFunction.screenshareOn(),screenShare=!screenShare},createRecivedMessageOutput=(message,peerId)=>{let createMessageOutput=document.createElement("div");if("FiLe-https://tradazine.com/"===message.substring(0,27)){let fileExtention=message.split(".").pop().toLowerCase(),fileLink=message.slice(5,message.length),fileName=message.slice(38,message.length);"jpg"===fileExtention||"png"===fileExtention||"jpeg"===fileExtention?(createMessageOutput.className="cems__messages__item cems__messages__item--visitor_image",createMessageOutput.innerHTML=` <a href="${fileLink}" download target="_blank">\n        <img src="${fileLink}" alt="" style="width:125px">\n        </a>`):(createMessageOutput.className="cems__messages__item cems__messages__item--visitor",createMessageOutput.innerHTML=` <a href="${fileLink}" download target="_blank">\n        <img src="https://img.icons8.com/carbon-copy/100/000000/file.png" style="width:70px"/><br>\n            <a href="${fileLink}" download target="_blank">${fileName}</a>\n        </a>`),document.getElementById("cems__chatbox__messages").appendChild(createMessageOutput)}else createMessageOutput.className="cems__messages__item cems__messages__item--visitor",createMessageOutput.innerHTML=`${message}`;let className=peerId,isClass=document.getElementsByClassName(`cems__messageFor${className}`)[0];1==inMessages&&null!=isClass&&(unreadMessageId=unreadMessageId.filter(uid=>uid!=peerId),isClass.appendChild(createMessageOutput))},mute=!1,mutecontrol=()=>{let getMuteButton=document.getElementById("muteMicrophone");!1!==mute?(agoraFunction.unmuteAudio(),getMuteButton.innerHTML='<svg class="cems__cancleBtn"   onclick=mutecontrol() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="96" height="96" viewBox="0 0 172 172" style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#2ecc71"></path><g fill="#ffffff"><path d="M86,27.95c-9.50013,0 -17.2,7.69987 -17.2,17.2v34.4c0,9.50013 7.69987,17.2 17.2,17.2c9.50013,0 17.2,-7.69987 17.2,-17.2v-34.4c0,-9.50013 -7.69987,-17.2 -17.2,-17.2zM52.10391,79.55c-3.4744,0 -6.2728,3.08292 -5.71094,6.51719c2.80864,17.19838 16.56553,30.68637 33.8737,33.16823v11.91458c0,3.1648 2.56853,5.73333 5.73333,5.73333c3.1648,0 5.73333,-2.56853 5.73333,-5.73333v-11.91458c17.30817,-2.48186 31.06506,-15.96985 33.8737,-33.16823c0.56187,-3.43427 -2.23654,-6.51719 -5.71094,-6.51719c-2.83227,0 -5.16788,2.08443 -5.64375,4.88229c-2.322,13.50201 -14.08527,23.78438 -28.25234,23.78438c-14.16707,0 -25.93034,-10.28237 -28.25234,-23.78438c-0.47587,-2.79786 -2.80575,-4.88229 -5.64375,-4.88229z"></path></g></g></svg>\n      '):(agoraFunction.muteAudio(),getMuteButton.innerHTML='<svg class="cems__cancleBtn"   onclick=mutecontrol() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="90" height="90" viewBox="0 0 172 172" style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#2ecc71"></path><g fill="#ffffff"><path d="M25.02958,18.54375l-6.48583,6.48583l128.42667,128.42667l6.48583,-6.48583l-38.34167,-38.34167c1.90629,-4.09492 2.99208,-8.64437 2.99208,-13.45542v-18.34667c0,-2.53643 -2.05024,-4.58667 -4.58667,-4.58667c-2.53643,0 -4.58667,2.05024 -4.58667,4.58667v18.34667c0,2.19677 -0.40004,4.27979 -0.99438,6.27979l-8.17896,-8.17896v-53.14084c0,-7.60011 -6.15989,-13.76 -13.76,-13.76c-7.60011,0 -13.76,6.15989 -13.76,13.76v25.62084zM54.92354,74.04958c-0.60544,0.77515 -1.03021,1.71298 -1.03021,2.77708v18.34667c0,16.14048 11.98955,29.50108 27.52,31.73938v9.54062h-13.76c-2.53643,0 -4.58667,2.05024 -4.58667,4.58667c0,2.53643 2.05024,4.58667 4.58667,4.58667h36.69333c2.53643,0 4.58667,-2.05024 4.58667,-4.58667c0,-2.53643 -2.05024,-4.58667 -4.58667,-4.58667h-13.76v-9.54062c4.55915,-0.65589 8.79916,-2.29161 12.53271,-4.65833l-6.74562,-6.74562c-3.12811,1.60992 -6.62186,2.59792 -10.37375,2.59792c-12.64544,0 -22.93333,-10.28789 -22.93333,-22.93333v-12.97167zM72.24,91.375v3.79833c0,7.60011 6.15989,13.76 13.76,13.76c1.16043,0 2.26818,-0.18626 3.34146,-0.45687z"></path></g></g></svg>'),mute=!mute},videoshare=!1,videoControl=()=>{let getVideoMuteBtn=document.getElementById("cems_videomuteBtn");getVideoMuteBtn.innerHTML=0==videoshare?'<svg class="cems__reciveBtn" onclick=videoControl() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="96" height="96" viewBox="0 0 172 172" style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#e74c3c"></path><g fill="#ffffff"><path d="M41.77143,51.6c-5.42046,0 -9.82857,4.40811 -9.82857,9.82857v49.14286c0,5.42046 4.40811,9.82857 9.82857,9.82857h63.88571c5.42046,0 9.82857,-4.40811 9.82857,-9.82857v-14.33973l16.58571,13.26473c0.88949,0.70766 1.97554,1.075 3.07143,1.075c0.7224,0 1.45263,-0.16516 2.1308,-0.48951c1.70526,-0.81577 2.78348,-2.53769 2.78348,-4.42478v-39.31429c0,-1.88709 -1.07822,-3.61369 -2.78348,-4.43438c-1.70034,-0.81086 -3.72795,-0.58434 -5.20223,0.59509l-16.58571,13.26473v-14.33973c0,-5.42046 -4.40811,-9.82857 -9.82857,-9.82857z"></path></g></g></svg>':'<svg class="cems__reciveBtn" onclick=videoControl() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="96" height="96" viewBox="0 0 172 172" style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#2aa826"></path><g fill="#ffffff"><path d="M53.93429,61.06c-3.92983,0 -7.12571,3.19588 -7.12571,7.12571v35.62857c0,3.92983 3.19588,7.12571 7.12571,7.12571h46.31714c3.92983,0 7.12571,-3.19588 7.12571,-7.12571v-10.39631l12.02464,9.61693c0.64488,0.51305 1.43227,0.77937 2.22679,0.77937c0.52374,0 1.05316,-0.11974 1.54483,-0.35489c1.23631,-0.59143 2.01802,-1.83983 2.01802,-3.20796v-28.50286c0,-1.36814 -0.78171,-2.61992 -2.01802,-3.21492c-1.23275,-0.58787 -2.70276,-0.42365 -3.77162,0.43144l-12.02464,9.61693v-10.39631c0,-3.92983 -3.19588,-7.12571 -7.12571,-7.12571z"></path></g></g></svg>',videoshare=!videoshare},recivedCallOutput=type=>{let output=`\n    <div id="cems__callsection">\n         \n         ${"video"==type?'<div id="cems__recivedcall__content">\n           <div id="cems__call__sender"></div>\n           <div id="cems__call__reciver"></div>':`<div id="cems__call__content">\n           <div  class="cems__callImage" >\n             <img class="cems__callImage" src="https://img.icons8.com/ios/50/000000/user-male-circle.png"/>\n           <h4 id='callingType'> talking with ${calleeName} </h4>\n         </div>\n           `}\n           <div id="cams__call__timer"><span id="minutes"></span>:<span id="seconds"></span></div>\n           <div class="cems__callButtons" >\n          <span id="muteMicrophone" ><svg class="cems__cancleBtn"   onclick=mutecontrol() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="96" height="96" viewBox="0 0 172 172" style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#2ecc71"></path><g fill="#ffffff"><path d="M86,27.95c-9.50013,0 -17.2,7.69987 -17.2,17.2v34.4c0,9.50013 7.69987,17.2 17.2,17.2c9.50013,0 17.2,-7.69987 17.2,-17.2v-34.4c0,-9.50013 -7.69987,-17.2 -17.2,-17.2zM52.10391,79.55c-3.4744,0 -6.2728,3.08292 -5.71094,6.51719c2.80864,17.19838 16.56553,30.68637 33.8737,33.16823v11.91458c0,3.1648 2.56853,5.73333 5.73333,5.73333c3.1648,0 5.73333,-2.56853 5.73333,-5.73333v-11.91458c17.30817,-2.48186 31.06506,-15.96985 33.8737,-33.16823c0.56187,-3.43427 -2.23654,-6.51719 -5.71094,-6.51719c-2.83227,0 -5.16788,2.08443 -5.64375,4.88229c-2.322,13.50201 -14.08527,23.78438 -28.25234,23.78438c-14.16707,0 -25.93034,-10.28237 -28.25234,-23.78438c-0.47587,-2.79786 -2.80575,-4.88229 -5.64375,-4.88229z"></path></g></g></svg>\n          </span>\n           ${"video"==type?'<span id="cems_shareScreenBtn"><svg class="cems__cancleBtn"   onclick=screenshare() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="100" height="100" viewBox="0 0 172 172" style=" fill:#000000;"><g transform=""><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#2ecc71"></path><g fill="#ffffff"><path d="M36.464,36.464c-5.73371,0 -10.42863,4.69492 -10.42863,10.42863v46.92884c0,5.73371 4.69492,10.42863 10.42863,10.42863h26.07158v20.85726c0,5.73371 4.69492,10.42863 10.42863,10.42863h62.57179c5.73371,0 10.42863,-4.69492 10.42863,-10.42863v-46.92884c0,-5.73371 -4.69492,-10.42863 -10.42863,-10.42863h-26.07158v-20.85726c0,-5.73371 -4.69492,-10.42863 -10.42863,-10.42863zM36.464,41.67832h62.57179c2.91269,0 5.21432,2.30163 5.21432,5.21432v20.85726h-31.28589c-5.73371,0 -10.42863,4.69492 -10.42863,10.42863v20.85726h-26.07158c-2.91268,0 -5.21432,-2.30163 -5.21432,-5.21432v-46.92884c0,-2.91268 2.30163,-5.21432 5.21432,-5.21432zM72.96421,72.96421h62.57179c2.91269,0 5.21432,2.30163 5.21432,5.21432v46.92884c0,2.91269 -2.30163,5.21432 -5.21432,5.21432h-62.57179c-2.91268,0 -5.21432,-2.30163 -5.21432,-5.21432v-22.97558c0.07129,-0.34626 0.07129,-0.71289 0,-1.05916v-22.89411c0,-2.91268 2.30163,-5.21432 5.21432,-5.21432z"></path></g><path d="" fill="none"></path></g></g></svg>\n             </span>\n             \n             ':""}\n           <svg class="cems__cancleBtn"  id="recivedCallCancle" onclick=cancelRecivedCall() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="96" height="96" viewBox="0 0 172 172" style=" fill:#000000;"><g transform=""><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#ff0000"></path><g fill="#ffffff"><path d="M121.73829,99.31467c-5.2127,0 -10.33071,-0.81528 -15.18081,-2.41812c-2.37655,-0.81066 -5.29815,-0.06698 -6.74856,1.4227l-9.57317,7.22665c-11.1021,-5.92636 -17.94074,-12.76269 -23.78626,-23.78165l7.01417,-9.32374c1.82225,-1.81994 2.47586,-4.47826 1.69292,-6.97259c-1.60977,-4.8755 -2.42736,-9.9912 -2.42736,-15.20621c0,-3.76691 -3.0648,-6.83171 -6.83171,-6.83171h-15.63579c-3.76691,0 -6.83171,3.0648 -6.83171,6.83171c0,43.17973 35.12856,78.30829 78.30829,78.30829c3.76691,0 6.83171,-3.0648 6.83171,-6.83171v-15.59191c0,-3.76691 -3.0648,-6.83171 -6.83171,-6.83171z"></path></g><path d="" fill="none"></path></g></g></svg>\n           </div>\n           \n         </div>\n     </div>\n    `;getModalSection.innerHTML=output,callTimer()},callInterval,callTimer=()=>{var sec=0;function pad(val){return val>9?val:"0"+val}callInterval=setInterval((function(){document.getElementById("seconds").innerHTML=pad(++sec%60),document.getElementById("minutes").innerHTML=pad(parseInt(sec/60,10))}),1e3)},outgoinCallOutput=type=>`\n    <div id="cems__callsection">\n         <div id="cems__call__content">\n           <h3 class="cems__calltype">Outgoing Call</h3>\n           <div  class="cems__callImage" >\n             <img class="cems__callImage" src="https://img.icons8.com/ios/50/000000/user-male-circle.png"/>\n           <h4 id='callingType'> Call ${calleeName} </h4>\n           <div class="cems__callButtons" >\n           <svg class="cems__cancleBtn" onclick=cancelOutgoingCall() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="96" height="96" viewBox="0 0 172 172" style=" fill:#000000;"><g transform=""><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#ff0000"></path><g fill="#ffffff"><path d="M121.73829,99.31467c-5.2127,0 -10.33071,-0.81528 -15.18081,-2.41812c-2.37655,-0.81066 -5.29815,-0.06698 -6.74856,1.4227l-9.57317,7.22665c-11.1021,-5.92636 -17.94074,-12.76269 -23.78626,-23.78165l7.01417,-9.32374c1.82225,-1.81994 2.47586,-4.47826 1.69292,-6.97259c-1.60977,-4.8755 -2.42736,-9.9912 -2.42736,-15.20621c0,-3.76691 -3.0648,-6.83171 -6.83171,-6.83171h-15.63579c-3.76691,0 -6.83171,3.0648 -6.83171,6.83171c0,43.17973 35.12856,78.30829 78.30829,78.30829c3.76691,0 6.83171,-3.0648 6.83171,-6.83171v-15.59191c0,-3.76691 -3.0648,-6.83171 -6.83171,-6.83171z"></path></g><path d="" fill="none"></path></g></g></svg>\n             \n           </div>\n         </div>\n     </div>\n    `,incomingCallOutput=(name,type)=>{calleeName=name;let output=`\n    <div id="cems__callsection">\n         <div id="cems__call__content">\n           <h3 class="cems__calltype">Incoming Call</h3>\n           <div  class="cems__callImage" >\n             <img class="cems__callImage" src="https://img.icons8.com/ios/50/000000/user-male-circle.png"/>\n           <h4 id='callingType'>Call from ${name} </h4>\n           <div class="cems__callButtons">\n           <svg  class="cems__cancleBtn" onclick=cancelIncoingCall() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="96" height="96" viewBox="0 0 172 172" style=" fill:#000000;"><g transform=""><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#ff0000"></path><g fill="#ffffff"><path d="M121.73829,99.31467c-5.2127,0 -10.33071,-0.81528 -15.18081,-2.41812c-2.37655,-0.81066 -5.29815,-0.06698 -6.74856,1.4227l-9.57317,7.22665c-11.1021,-5.92636 -17.94074,-12.76269 -23.78626,-23.78165l7.01417,-9.32374c1.82225,-1.81994 2.47586,-4.47826 1.69292,-6.97259c-1.60977,-4.8755 -2.42736,-9.9912 -2.42736,-15.20621c0,-3.76691 -3.0648,-6.83171 -6.83171,-6.83171h-15.63579c-3.76691,0 -6.83171,3.0648 -6.83171,6.83171c0,43.17973 35.12856,78.30829 78.30829,78.30829c3.76691,0 6.83171,-3.0648 6.83171,-6.83171v-15.59191c0,-3.76691 -3.0648,-6.83171 -6.83171,-6.83171z"></path></g><path d="" fill="none"></path></g></g></svg>\n             ${"audio"===type?'<svg class="cems__reciveBtn" onclick=reciveIncomingCall() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="96" height="96" viewBox="0 0 172 172" style=" fill:#000000;"><g transform=""><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#44b43c"></path><g fill="#ffffff"><path d="M121.73829,99.31467c-5.2127,0 -10.33071,-0.81528 -15.18081,-2.41812c-2.37655,-0.81066 -5.29815,-0.06698 -6.74856,1.4227l-9.57317,7.22665c-11.1021,-5.92636 -17.94074,-12.76269 -23.78626,-23.78165l7.01417,-9.32374c1.82225,-1.81994 2.47586,-4.47826 1.69292,-6.97259c-1.60977,-4.8755 -2.42736,-9.9912 -2.42736,-15.20621c0,-3.76691 -3.0648,-6.83171 -6.83171,-6.83171h-15.63579c-3.76691,0 -6.83171,3.0648 -6.83171,6.83171c0,43.17973 35.12856,78.30829 78.30829,78.30829c3.76691,0 6.83171,-3.0648 6.83171,-6.83171v-15.59191c0,-3.76691 -3.0648,-6.83171 -6.83171,-6.83171z"></path></g><path d="" fill="none"></path></g></g></svg>':'<svg class="cems__reciveBtn" onclick=reciveIncomingCall() xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="96" height="96" viewBox="0 0 172 172" style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><path d="M86,172c-47.49649,0 -86,-38.50351 -86,-86v0c0,-47.49649 38.50351,-86 86,-86v0c47.49649,0 86,38.50351 86,86v0c0,47.49649 -38.50351,86 -86,86z" fill="#2aa826"></path><g fill="#ffffff"><path d="M53.93429,61.06c-3.92983,0 -7.12571,3.19588 -7.12571,7.12571v35.62857c0,3.92983 3.19588,7.12571 7.12571,7.12571h46.31714c3.92983,0 7.12571,-3.19588 7.12571,-7.12571v-10.39631l12.02464,9.61693c0.64488,0.51305 1.43227,0.77937 2.22679,0.77937c0.52374,0 1.05316,-0.11974 1.54483,-0.35489c1.23631,-0.59143 2.01802,-1.83983 2.01802,-3.20796v-28.50286c0,-1.36814 -0.78171,-2.61992 -2.01802,-3.21492c-1.23275,-0.58787 -2.70276,-0.42365 -3.77162,0.43144l-12.02464,9.61693v-10.39631c0,-3.92983 -3.19588,-7.12571 -7.12571,-7.12571z"></path></g></g></svg>'}\n             \n           </div>\n         </div>\n     </div>\n    `;getModalSection.innerHTML=output},reciveMessageStoreAndOutput=(message,peerId)=>{let peerDetails=friendList.find(d=>d.id==peerId);chatListDataStore(message,peerId,peerDetails.name,"recive"),newChatListStore(message,peerId,peerDetails.name,"recive"),createRecivedMessageOutput(message.text,peerId),scrollBottom(),gotoChatList();var chatEl=document.getElementById("cems__chatbox__messages");chatEl.scrollTop=chatEl.scrollHeight,document.getElementById("cems__log").appendChild(document.createElement("div")).append("Message from: "+peerId+" Message: "+message.text)},getChatData=async(authToken,uid)=>{try{let response=await axios.get(`https://tradazine.com/api/v1/all-chat-message/${uid}`,{headers:{Authorization:`Bearer ${authToken}`}});return await response}catch(err){console.error(err)}},getFriendListData=async(authToken,uid)=>{try{let response=await axios.get("https://tradazine.com/api/v1/get-all-users",{headers:{Authorization:`Bearer ${authToken}`}}),friendlist=await response.data.data.filter(d=>d.id!=uid);return await friendlist}catch(err){console.error(err)}};"/"===cmsdir&&(cmsdir="../../");let chatListsDiv=document.getElementById("cems__all__chatlist"),chatboxChattingDiv=document.getElementById("cems__chatbox__chatting"),chatlistHeaderText=document.getElementById("cems__chatlist__header__text"),chatboxMessagesDiv=document.getElementById("cems__chatbox__messages"),scrollBottom=()=>{var chatEl=document.getElementById("cems__chatbox__messages");chatEl.scrollTop=chatEl.scrollHeight},usersToggle=data=>{let element=`\n    <div class="cems__chat__list" id='${data.id}' onclick={showMesseges(this.id)}>\n    <div class="cems__friend__icon">\n      <p>${data.name.toUpperCase().charAt(0)}</p>\n    </div>\n    <div class="cems__chatlist__content">\n      <h4 class="cems__chatlist__friendName">${data.name}</h4>\n    </div>\n  </div>\n    `;return chatListsDiv.innerHTML+=element},chatsToggle=data=>{let lastMessageDetails=data.messages.pop(),lastMessage="";null!=lastMessageDetails&&(data.messages.push(lastMessageDetails),lastMessage=2==lastMessageDetails.messageType?"FiLe-https://tradazine.com/"===lastMessageDetails.text.substring(0,27)?"You : Send a file":`You : ${lastMessageDetails.text}`:"FiLe-https://tradazine.com/"===lastMessageDetails.text.substring(0,27)?" Send a file":lastMessageDetails.text);let isUnread,setclass="";null!=unreadMessageId.find(id=>id==data.id)&&(setclass="unseen__message");let element=`\n    <div class="cems__chat__list ${setclass}" id='${data.id}' onclick={showMesseges(this.id)}>\n    <div class="cems__friend__icon">\n      <p>${data.name.toUpperCase().charAt(0)}</p>\n    </div>\n    <div class="cems__chatlist__content">\n      <h4 class="cems__chatlist__friendName">${data.name}</h4>\n      <p> ${lastMessage}</p>\n    </div>\n  </div>\n    `;return chatListsDiv.innerHTML+=element},gotoChatList=()=>{let className=calleeId;chatListsDiv.innerHTML="",chatlistHeaderText.innerText="Chats",chatListData.length<1?chatListsDiv.innerHTML='<p class="cems__no_found">No Chats found</p>':chatListData.map(data=>{chatsToggle(data)})},gotoUsers=()=>{chatListsDiv.innerHTML="",chatlistHeaderText.innerText="Users",friendList.length<1?chatListsDiv.innerHTML='<p class="cems__no_found">No Friend found</p>':friendList.map(data=>{usersToggle(data)})};function showMesseges(id){inMessages=!0;let exactData=chatListData.find(data=>data.id==id);null==exactData&&(exactData=friendList.find(data=>data.id==id),exactData.messages=[]),calleeId=exactData.id,unreadMessageId=unreadMessageId.filter(id=>id!=exactData.id),calleeName=exactData.name,chatboxChattingDiv.innerHTML=chatboxChating(exactData),chatbox.gotoChat(),scrollBottom(),filesend()}let backToChatList=()=>{inMessages=!1,gotoChatList(),chatbox.backTochatList()},controlSentOrReciveMessage=data=>{let chatboxMessages=document.createElement("ul");return chatboxMessages.innerHTML="",data.messages.map(m=>{let message=m.text;if(2==m.messageType)if("FiLe-https://tradazine.com/"===message.substring(0,27)){let fileExtention=message.split(".").pop().toLowerCase(),fileLink=message.slice(5,message.length),fileName=message.slice(38,message.length);chatboxMessages.innerHTML+="jpg"===fileExtention||"png"===fileExtention||"jpeg"===fileExtention?`<div class="cems__messages__item cems__messages__item--operator_image">\n<a href="${fileLink}" download target="_blank">\n        <img src="${fileLink}" alt="" style="width:125px">\n        </a>\n      </div>`:`<div class="cems__messages__item cems__messages__item--operator"  >\n      <a href="${fileLink}" download target="_blank">\n      <img src="https://img.icons8.com/carbon-copy/100/000000/file.png" style="width:70px"/><br>\n      <a href="${fileLink}" download target="_blank" style="color:#ffecec">${fileName}</a>\n      </a>\n      </div>`}else chatboxMessages.innerHTML+=`<div class="cems__messages__item cems__messages__item--operator">${m.text}</div>`;else if("FiLe-https://tradazine.com/"===message.substring(0,27)){let fileExtention=message.split(".").pop().toLowerCase(),fileLink=message.slice(5,message.length),fileName=message.slice(38,message.length);chatboxMessages.innerHTML+="jpg"===fileExtention||"png"===fileExtention||"jpeg"===fileExtention?`<div class="cems__messages__item cems__messages__item--visitor_image" >\n          <a href="${fileLink}" download target="_blank">\n          <img src="${fileLink}" alt="" style="width:125px">\n          </a>\n      </div>`:`<div class="cems__messages__item cems__messages__item--visitor"  >\n      <a href="${fileLink}" download target="_blank">\n      <img src="https://img.icons8.com/carbon-copy/100/000000/file.png" style="width:70px"/><br>\n          <a href="${fileLink}" download target="_blank">${fileName}</a>\n      </a>\n      </div>`}else chatboxMessages.innerHTML+=`<div class="cems__messages__item cems__messages__item--visitor">${m.text}</div>`}),chatboxMessages.innerHTML},createMessageOutput=message=>{if("FiLe-https://tradazine.com/"===message.substring(0,27)){let fileExtention=message.split(".").pop().toLowerCase(),fileLink=message.slice(5,message.length),fileName=message.slice(38,message.length),createMessageOutput=document.createElement("div");"jpg"===fileExtention||"png"===fileExtention||"jpeg"===fileExtention?(createMessageOutput.className="cems__messages__item cems__messages__item--operator_image",createMessageOutput.innerHTML=`<a href="${fileLink}" download target="_blank">\n      <img src="${fileLink}" alt="" style="width:125px">\n      </a>`):(createMessageOutput.className="cems__messages__item cems__messages__item--operator",createMessageOutput.innerHTML=`<a href="${fileLink}" download target="_blank">\n      <img src="https://img.icons8.com/carbon-copy/100/000000/file.png" style="width:70px"/><br>\n      <a href="${fileLink}" download target="_blank" style="color:#ffecec">${fileName}</a>\n      </a>`),document.getElementById("cems__chatbox__messages").appendChild(createMessageOutput)}else{let createMessageOutput=document.createElement("div");createMessageOutput.className="cems__messages__item cems__messages__item--operator",createMessageOutput.innerHTML=`${message}`,document.getElementById("cems__chatbox__messages").appendChild(createMessageOutput)}},sendMessage=async(id,message=null)=>{if(void 0!==selectFile){document.getElementById("sendMessageBtn").disabled=!0;let formData=new FormData;formData.append("file",selectFile);let sendFile=await fetch("https://tradazine.com/api/v1/store-chat-file",{method:"POST",body:formData,headers:{Accept:"application/json",Authorization:`Bearer ${allDetails.access_token}`}}).then(response=>response.json()).then(data=>(document.getElementById("cems_send_message").innerHTML='<input id="cems__input__message" type="text" placeholder="Write a message..." autocomplete="off"/>',selectFile=void 0,document.getElementById("sendMessageBtn").disabled=!1,data));if(sendFile.errors)return void alert(sendFile.errors.file[0]);message={text:`FiLe-https://tradazine.com/${sendFile.data.path}`,type:"TEXT"}}else null==message&&(typeMessage=document.getElementById("cems__input__message").value,message={text:typeMessage,type:"TEXT"},document.getElementById("cems__input__message").value="");if(0==message.text.length)alert("write something");else{let exactMessagesData=chatListDataStore(message,id,allDetails.userName,"sent");newChatListStore(message,id,allDetails.userName,"sent"),createMessageOutput(message.text);var chatEl=document.getElementById("cems__chatbox__messages");chatEl.scrollTop=chatEl.scrollHeight,await agoraFunction.sendPeerMessage(message,exactMessagesData.id)}},filesend=()=>{document.getElementById("cems_file_upload").addEventListener("change",(function(e){if(selectFile=e.target.files[0],void 0===selectFile)document.getElementById("cems_send_message").innerHTML='<input id="cems__input__message" type="text" placeholder="Write a message..." autocomplete="off"/>';else{let fileName=e.target.files[0].name;fileName.length>30&&(fileName=fileName.substring(0,30)+"...");let filedata=`\n      <div id="selectFileShow">\n      <p>${fileName}</p>\n      </div>\n      `;document.getElementById("cems_send_message").innerHTML=filedata}}))},chatListDataStore=(message,id,name,type)=>{let messageType;messageType="sent"==type?2:3;let exactMessagesData=chatListData.find(d=>d.id==id);if(null==exactMessagesData)exactMessagesData=friendList.find(data=>data.id==id),exactMessagesData.messages=[{messageType:messageType,text:message.text,timeStamp:null,username:name}],chatListData.unshift(exactMessagesData),document.getElementById("cems__chatbox__messages").innerHTML="";else{let withoutExactMessagesData=chatListData.filter(d=>d.id!=id);0==exactMessagesData.messages.length&&(document.getElementById("cems__chatbox__messages").innerHTML=""),exactMessagesData.messages.push({messageType:messageType,text:message.text,timeStamp:null,username:name}),chatListData=[exactMessagesData,...withoutExactMessagesData]}return exactMessagesData},newChatListStore=(message,id,name,type)=>{let messageType;messageType="sent"==type?2:3;let exactMessagesData=newChatList.find(d=>d.id==id);if(null==exactMessagesData)exactMessagesData=friendList.find(data=>data.id==id),exactMessagesData.messages=[{messageType:messageType,text:message.text,timeStamp:null,username:name}],newChatList.unshift(exactMessagesData);else{let withoutExactMessagesData=newChatList.filter(d=>d.id!=id);newChatList=[exactMessagesData,...withoutExactMessagesData]}},chatboxChating=data=>(clickFriendId=data.id,`\n  <div class="cems__chatbox__header">\n    <div class="cems__chat__details">\n    <div id="cems__chatbox_backButton--header" onclick=backToChatList()>\n    <img src="https://img.icons8.com/ios-filled/100/000000/left.png"/>\n    </div>\n    <div class="cems__chatHead__friend__icon">\n      <p>${data.name.toUpperCase().charAt(0)}</p>\n    </div>\n    <div class="cems__chatbox__content--header">\n      <h4 class="cems__chatbox__heading--header">${data.name}</h4>\n    </div>\n  </div>\n  <div class="cems__chat__callicon">\n  <img src="https://img.icons8.com/color/96/000000/outgoing-call.png" onclick=agoraFunction.audioVideoCall('audio')>\n  <img src="https://img.icons8.com/color/96/000000/video-call--v1.png"onclick=agoraFunction.audioVideoCall('video')>\n  </div>\n</div>\n<div id="cems__chatbox__messages" class="cems__messageFor${data.id}">\n  ${data.messages.length?controlSentOrReciveMessage(data):'<p class="cems__no_found">No message found</p>'}\n</div>\n<div class="cems__chatbox__footer">\n<label for="cems_file_upload"><img src="https://img.icons8.com/external-kmg-design-outline-color-kmg-design/64/000000/external-attachment-user-interface-kmg-design-outline-color-kmg-design.png"/></label>\n\n<input type="file" id="cems_file_upload" name="cems_file_upload" style="display:none;">\n  \n  <div id="cems_send_message">\n  <input id="cems__input__message" type="text" placeholder="Write a message..." autocomplete="off"/>\n  </div>\n  <button id="sendMessageBtn" class="cems__chatbox__send--footer" onclick=sendMessage('${data.id}')>Send</button>\n  \n</div>\n  `);var modal=document.getElementById("cems__myModal"),btn=document.getElementById("cems__myBtn");class InteractiveChatbox{constructor(chatToggleButton,chatbox,icons,chatSection,chatList){this.args={chatToggleButton:chatToggleButton,chatbox:chatbox,chatSection:chatSection,chatList:chatList},this.icons=icons,this.showChatbox=!1,this.isBack=!0}display(){const{chatToggleButton:chatToggleButton,chatbox:chatbox}=this.args;chatToggleButton.addEventListener("click",()=>this.toggleState(chatbox))}toggleState(chatbox){this.showChatbox=!this.showChatbox,this.showOrHideChatBox(chatbox,this.args.chatToggleButton)}showOrHideChatBox(chatbox,chatToggleButton){this.showChatbox?(chatbox.classList.add("cems__chatbox--active"),this.toggleIcon(!0,chatToggleButton)):this.showChatbox||(chatbox.classList.remove("cems__chatbox--active"),this.toggleIcon(!1,chatToggleButton))}toggleIcon(showChatbox,chatToggleButton){const{isClicked:isClicked,isNotClicked:isNotClicked}=this.icons;showChatbox?chatToggleButton.children[0].innerHTML=isClicked:showChatbox||(chatToggleButton.children[0].innerHTML=isNotClicked)}gotoChat(){const{chatSection:chatSection,chatList:chatList}=this.args;if(this.isBack=!this.isBack,!this.isBack){chatSection.classList.remove("cems__hide__section"),chatList.classList.add("cems__hide__section");var chatEl=document.getElementById("cems__chatbox__messages");chatEl.scrollTop=chatEl.scrollHeight}}backTochatList(){const{chatSection:chatSection,chatList:chatList}=this.args;this.isBack=!this.isBack,this.isBack&&(chatList.classList.remove("cems__hide__section"),chatSection.classList.add("cems__hide__section"))}}const chatToggleButton=document.querySelector(".cems__chatbox__button"),chatContent=document.querySelector(".cems__chatbox__support"),chatList=document.getElementById("cems__chatbox__chatlists"),chatSection=document.getElementById("cems__chatbox__chatting"),icons={isClicked:'<img src="https://img.icons8.com/material/96/ffffff/expand-arrow--v1.png"/>',isNotClicked:'<img src="https://img.icons8.com/fluency-systems-regular/96/ffffff/chat.png"/>'},chatbox=new InteractiveChatbox(chatToggleButton,chatContent,icons,chatSection,chatList);chatbox.display(),chatbox.toggleIcon(!1,chatToggleButton);let getAuthToken=async(email,pass)=>{try{const response=await axios.post(`https://tradazine.com/api/v1/login?username=${email}&password=${pass}`);let res={token:response.data.access_token,uid:response.data.chat_uid,name:response.data.name};return allDetails.access_token=response.data.access_token,await res}catch(error){console.error(error)}},cemsChatInit=async(email,pass,appId)=>{let authData=await getAuthToken(email,pass);await agoraFunction.init(authData.uid,authData.name,appId,authData.token)};